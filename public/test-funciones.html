<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Funciones - PsiquiApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 40px; background: #f5f5f5; }
        .test-section { background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn-test { margin: 10px; }
        #console-output { 
            background: #1e1e1e; 
            color: #00ff00; 
            padding: 20px; 
            border-radius: 5px; 
            font-family: 'Courier New', monospace; 
            max-height: 400px; 
            overflow-y: auto;
            font-size: 14px;
        }
        .status-ok { color: #28a745; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">üß™ Test de Funciones - PsiquiApp v3.0.0</h1>
        
        <div class="test-section">
            <h3>üìä Estado de Carga del JavaScript</h3>
            <p id="version-status">Verificando versi√≥n...</p>
            <p id="functions-status">Verificando funciones...</p>
        </div>

        <div class="test-section">
            <h3>üë• Test Funciones de Pacientes</h3>
            <button class="btn btn-primary btn-test" onclick="testFunction('viewPaciente', 4)">
                Test viewPaciente(4)
            </button>
            <button class="btn btn-success btn-test" onclick="testFunction('editPaciente', 4)">
                Test editPaciente(4)
            </button>
            <button class="btn btn-danger btn-test" onclick="testFunction('deletePaciente', 4)">
                Test deletePaciente(4)
            </button>
        </div>

        <div class="test-section">
            <h3>üìÖ Test Funciones de Citas</h3>
            <button class="btn btn-primary btn-test" onclick="testFunction('viewCita', 4)">
                Test viewCita(4)
            </button>
            <button class="btn btn-success btn-test" onclick="testFunction('editCita', 4)">
                Test editCita(4)
            </button>
            <button class="btn btn-danger btn-test" onclick="testFunction('deleteCita', 4)">
                Test deleteCita(4)
            </button>
        </div>

        <div class="test-section">
            <h3>ü©∫ Test Funciones de Consultas</h3>
            <button class="btn btn-primary btn-test" onclick="testFunction('viewConsulta', 6)">
                Test viewConsulta(6)
            </button>
            <button class="btn btn-success btn-test" onclick="testFunction('editConsulta', 6)">
                Test editConsulta(6)
            </button>
            <button class="btn btn-danger btn-test" onclick="testFunction('deleteConsulta', 6)">
                Test deleteConsulta(6)
            </button>
        </div>

        <div class="test-section">
            <h3>üíä Test Funciones de Recetas</h3>
            <button class="btn btn-primary btn-test" onclick="testFunction('viewReceta', 1)">
                Test viewReceta(1)
            </button>
            <button class="btn btn-success btn-test" onclick="testFunction('editReceta', 1)">
                Test editReceta(1)
            </button>
            <button class="btn btn-danger btn-test" onclick="testFunction('deleteReceta', 1)">
                Test deleteReceta(1)
            </button>
        </div>

        <div class="test-section">
            <h3>üìù Consola de Salida</h3>
            <div id="console-output">
                Esperando pruebas...<br>
            </div>
            <button class="btn btn-warning mt-3" onclick="clearConsole()">Limpiar Consola</button>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dashboard JS con timestamp √∫nico -->
    <script src="/js/dashboard.js?v=3.0.0&t=20251001200500"></script>

    <script>
        // Esperar a que el DOM est√© listo
        window.addEventListener('DOMContentLoaded', function() {
            logConsole('‚úÖ DOM Cargado');
            
            // Verificar versi√≥n
            setTimeout(() => {
                const versionEl = document.getElementById('version-status');
                versionEl.innerHTML = '<span class="status-ok">‚úÖ JavaScript v3.0.0 cargado correctamente</span>';
                
                // Verificar que todas las funciones existan
                const functions = [
                    'viewPaciente', 'editPaciente', 'deletePaciente',
                    'viewCita', 'editCita', 'deleteCita',
                    'viewConsulta', 'editConsulta', 'deleteConsulta',
                    'viewReceta', 'editReceta', 'deleteReceta'
                ];
                
                let allFound = true;
                let missingFunctions = [];
                
                functions.forEach(fn => {
                    if (typeof window[fn] !== 'function') {
                        allFound = false;
                        missingFunctions.push(fn);
                        logConsole(`‚ùå Funci√≥n ${fn} NO encontrada`, 'error');
                    } else {
                        logConsole(`‚úÖ Funci√≥n ${fn} encontrada`);
                    }
                });
                
                const functionsEl = document.getElementById('functions-status');
                if (allFound) {
                    functionsEl.innerHTML = '<span class="status-ok">‚úÖ Todas las 12 funciones est√°n disponibles</span>';
                } else {
                    functionsEl.innerHTML = `<span class="status-error">‚ùå Faltan ${missingFunctions.length} funciones: ${missingFunctions.join(', ')}</span>`;
                }
            }, 500);
        });

        function logConsole(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString('es-ES');
            const color = type === 'error' ? '#ff4444' : type === 'success' ? '#44ff44' : '#00ff00';
            output.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = 'Consola limpia. Esperando pruebas...<br>';
        }

        function testFunction(functionName, id) {
            logConsole(`üß™ Probando ${functionName}(${id})...`);
            
            if (typeof window[functionName] === 'function') {
                try {
                    window[functionName](id);
                    logConsole(`‚úÖ ${functionName}(${id}) ejecutado exitosamente`, 'success');
                } catch (error) {
                    logConsole(`‚ùå Error al ejecutar ${functionName}: ${error.message}`, 'error');
                }
            } else {
                logConsole(`‚ùå Funci√≥n ${functionName} no existe`, 'error');
            }
        }

        // Capturar console.log del dashboard.js
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logConsole(args.join(' '));
        };
    </script>
</body>
</html>
